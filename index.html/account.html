<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/jpg" href="image/gus1.jpg">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer"/>
    <title>Account - Bike Shop</title> 
</head>
<body>

    <nav class="navbar">
        <div class="logo"><h1>SHOP</h1></div>
        <ul class="menu">
            <li><a href="index.html">Home</a></li>
            <li><a href="collections.html">Collections</a></li>
            <li><a href="newarrivals.html">New Arrivals</a></li>
            <li><a href="bestseller.html">Best Seller</a></li>
            <li><a href="account.html" class="active">Account</a></li>
            <li><a href="AboutUs.html">About Us</a></li>
            <li><a href=""><i class="fas fa-shopping-cart"></i></a></li>
        </ul>
        <div class="menu-bnt">
            <i class="fa fa-bars"></i>
        </div>  
    </nav>

    <section class="account-section">
        <div class="account-card">
            <div class="account-tabs">
                <button class="account-tab active" data-target="loginForm">Log In</button>
                <button class="account-tab" data-target="signupForm">Create Account</button>
            </div>

            <div id="accountStatus" class="account-status hidden">
                <p id="accountWelcome"></p>
                <button type="button" id="logoutBtn" class="logout-btn">Log Out</button>
            </div>

            <div id="accountMessage" class="account-message" role="alert" aria-live="polite" tabindex="-1"></div>

            <form id="loginForm" class="account-form active" autocomplete="on">
                <div class="form-field">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" name="email" placeholder="Enter Your Email" required>
                </div>
                <div class="form-field">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" name="password" placeholder="••••••••" required minlength="6">
                </div>
                <button type="submit" class="primary-btn">Log In</button>
            </form>

            <form id="signupForm" class="account-form" autocomplete="on">
                <div class="form-field">
                    <label for="signupName">Your Name</label>
                    <input type="text" id="signupName" name="name" placeholder="Input Name" required minlength="2">
                </div>
                <div class="form-field">
                    <label for="signupEmail">Email</label>
                    <input type="email" id="signupEmail" name="email" placeholder="Enter Your Email" required>
                </div>
                <div class="form-field">
                    <label for="signupPassword">Password</label>
                    <input type="password" id="signupPassword" name="password" placeholder="Choose a password" required minlength="6">
                </div>
                <div class="form-field">
                    <label for="signupConfirm">Confirm Password</label>
                    <input type="password" id="signupConfirm" name="confirm" placeholder="Confirm your password" required minlength="6">
                </div>
                <button type="submit" class="primary-btn">Create Account</button>
            </form>
        </div>
    </section>

    <footer>
        <p>Copyrights at <a href="">Bike Shop</a></p>
    </footer>

    <script>
        (function() {
            const userStorageKey = "bikeShopUsers";
            const currentUserKey = "bikeShopCurrentUser";

            const tabs = document.querySelectorAll(".account-tab");
            const forms = document.querySelectorAll(".account-form");
            const messageBox = document.getElementById("accountMessage");
            const statusBox = document.getElementById("accountStatus");
            const welcomeText = document.getElementById("accountWelcome");
            const logoutBtn = document.getElementById("logoutBtn");

            const loginForm = document.getElementById("loginForm");
            const signupForm = document.getElementById("signupForm");
            const loginEmailInput = document.getElementById("loginEmail");
            const loginPasswordInput = document.getElementById("loginPassword");

            function loadUsers() {
                try {
                    const users = JSON.parse(localStorage.getItem(userStorageKey));
                    return Array.isArray(users) ? users : [];
                } catch (err) {
                    console.warn("Unable to parse stored users", err);
                    return [];
                }
            }

            function saveUsers(users) {
                localStorage.setItem(userStorageKey, JSON.stringify(users));
            }

            function setMessage(text, type = "info") {
                messageBox.textContent = text;
                messageBox.className = "account-message " + type;
                if (text) {
                    messageBox.focus();
                }
            }

            function showForm(targetId) {
                tabs.forEach((btn) => {
                    btn.classList.toggle("active", btn.dataset.target === targetId);
                });
                forms.forEach((form) => {
                    form.classList.toggle("active", form.id === targetId);
                });
            }

            function getCurrentUser() {
                try {
                    return JSON.parse(localStorage.getItem(currentUserKey));
                } catch (err) {
                    return null;
                }
            }

            function setCurrentUser(user) {
                if (user) {
                    localStorage.setItem(currentUserKey, JSON.stringify({ name: user.name, email: user.email }));
                } else {
                    localStorage.removeItem(currentUserKey);
                }
                updateStatus();
            }

            function updateStatus() {
                const user = getCurrentUser();
                if (user) {
                    statusBox.classList.remove("hidden");
                    welcomeText.textContent = "Signed in as " + user.name + " (" + user.email + ")";
                } else {
                    statusBox.classList.add("hidden");
                    welcomeText.textContent = "";
                }
            }

            tabs.forEach((tab) => {
                tab.addEventListener("click", () => {
                    showForm(tab.dataset.target);
                    setMessage("");
                });
            });

            signupForm.addEventListener("submit", (event) => {
                event.preventDefault();
                const formData = new FormData(signupForm);
                const name = formData.get("name").trim();
                const email = formData.get("email").trim().toLowerCase();
                const password = formData.get("password");
                const confirm = formData.get("confirm");

                if (password !== confirm) {
                    setMessage("Passwords do not match. Please try again.", "error");
                    return;
                }

                const users = loadUsers();
                if (users.some((user) => user.email === email)) {
                    setMessage("An account with that email already exists. Try logging in.", "error");
                    return;
                }

                const newUser = { name, email, password };
                users.push(newUser);
                saveUsers(users);
                setCurrentUser(null);
                signupForm.reset();
                showForm("loginForm");
                loginEmailInput.value = email;
                loginPasswordInput.value = "";
                setMessage("Account created successfully! Please log in.", "success");
            });

            loginForm.addEventListener("submit", (event) => {
                event.preventDefault();
                const formData = new FormData(loginForm);
                const email = formData.get("email").trim().toLowerCase();
                const password = formData.get("password");

                const users = loadUsers();
                const user = users.find((entry) => entry.email === email && entry.password === password);

                if (!user) {
                    setMessage("We could not find an account with those credentials. Please try again.", "error");
                    return;
                }

                setCurrentUser(user);
                loginForm.reset();
                setMessage("Welcome back, " + user.name + "! Redirecting to home...", "success");
                try {
                    window.location.assign("./index.html");
                } catch (error) {
                    window.location.href = "./index.html";
                }
            });

            logoutBtn.addEventListener("click", () => {
                setCurrentUser(null);
                setMessage("You have been logged out.", "info");
            });

            updateStatus();
            showForm("loginForm");
        })();

        $(".menu-bnt").click(function (){ 
            $(".navbar .menu").toggleClass("active");
            $(".menu-bnt i").toggleClass("active");
        });
    </script>

</body>
</html>

